#!/bin/bash
# Sub-Agent MCP Server 停止脚本
# 使用方法: ./stop_server [port]

PORT=${1:-8018}

echo "========================================"
echo "  停止 Sub-Agent MCP Server"
echo "========================================"
echo "端口: $PORT"
echo "----------------------------------------"

# 查找占用端口的进程
# Windows: 使用 netstat + taskkill
if command -v netstat &> /dev/null; then
    PID=$(netstat -ano 2>/dev/null | grep ":$PORT.*LISTENING" | awk '{print $5}' | head -1)
    
    if [ -n "$PID" ]; then
        echo "找到进程 PID: $PID"
        echo "正在停止..."
        
        # 使用 taskkill 停止进程
        taskkill //F //PID "$PID" 2>/dev/null
        
        if [ $? -eq 0 ]; then
            echo "✅ 已停止端口 $PORT 上的服务 (PID: $PID)"
        else
            echo "❌ 停止失败，请手动执行: taskkill /F /PID $PID"
        fi
    else
        echo "⚠️  端口 $PORT 上没有运行的服务"
    fi
else
    echo "❌ 未找到 netstat 命令"
    echo "   请手动停止服务或使用 taskkill"
fi
